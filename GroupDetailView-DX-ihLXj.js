import{u as A,a as G,l as J,o,c as l,b as t,i as S,t as n,d as i,F as j,r as M,n as f,h as B,q as D,g as K,j as g,e as v,f as P,C as W}from"./index-R9P4HaMK.js";const X={class:"page-container"},Y={class:"page-content"},Z={class:"mb-4"},tt={class:"text-xl font-semibold text-gray-800"},et={class:"text-sm text-gray-500"},st={class:"flex space-x-2 mb-4 overflow-x-auto pb-2"},at={key:0,class:"badge bg-green-100 text-green-700 whitespace-nowrap"},nt={key:1,class:"badge bg-orange-100 text-orange-700 whitespace-nowrap"},ot={key:2,class:"badge bg-red-100 text-red-700 whitespace-nowrap"},lt={key:0,class:"mb-4"},rt={key:1,class:"flex justify-center py-12"},it={key:2,class:"text-center py-12"},ut={key:3,class:"space-y-3"},dt={class:"flex items-start"},ct={class:"flex-1 min-w-0"},vt={class:"flex items-center"},pt={class:"text-sm font-medium text-gray-800 truncate"},yt={class:"grid grid-cols-2 gap-2 text-xs text-gray-500 mt-1"},xt={key:0},gt={key:1},bt={key:2},ft={key:3},mt={key:4},_t={class:"ml-4 flex flex-col space-y-2"},ht=["onClick"],kt=["onClick"],wt={key:1,class:"px-3 py-1 bg-gray-100 text-gray-500 rounded-lg text-sm"},qt={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ct={class:"bg-white rounded-xl p-6 mx-4 w-full max-w-sm"},St={class:"mb-4"},jt=["value","disabled"],Mt={key:0,class:"mb-4"},Bt={class:"bg-gray-50 rounded-lg p-3"},Dt={class:"flex justify-between text-sm mb-2"},Vt={class:"font-medium"},Nt={class:"flex justify-between text-sm mb-2"},zt={class:"font-medium"},Ft={class:"flex justify-between text-sm mb-2"},It={class:"font-medium"},Ot={class:"flex justify-between text-sm"},Ut={class:"font-medium"},$t={class:"mb-4"},Ht={class:"flex items-center border border-gray-200 rounded-lg"},Qt=["disabled"],Rt={class:"w-16 text-center font-medium"},Et=["disabled"],Lt={class:"mb-4"},Tt={class:"flex space-x-3"},At=["disabled"],Kt={__name:"GroupDetailView",setup(Gt){const k=P(),V=W(),y=A(),N=G(),m=g(!0),x=g(!1),u=g(""),b=g(!1),r=g({quantity:1,reason:""}),w=v(()=>V.params.name),c=v(()=>y.materials.filter(a=>a.name===decodeURIComponent(w.value)).map(a=>({...a,calculatedStatus:y.calculateStatus(a.expiry_date)}))),q=v(()=>c.value.filter(a=>a.quantity>0)),_=v(()=>c.value.filter(a=>a.quantity>0)),z=v(()=>c.value.reduce((a,e)=>a+e.quantity,0)),p=v(()=>{const a={normal:0,warning:0,expired:0};return c.value.forEach(e=>{a[e.calculatedStatus]++}),a}),d=v(()=>c.value.find(a=>a.id===u.value));function h(a){return a?new Date(a).toLocaleDateString("zh-CN"):"-"}function F(a){return{normal:"正常",warning:"预警",expired:"过期"}[a]||a}function I(a){switch(a){case"normal":return"bg-green-100 text-green-700";case"warning":return"bg-orange-100 text-orange-700";case"expired":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}}function O(a){switch(a){case"normal":return"bg-green-500";case"warning":return"bg-yellow-500";case"expired":return"bg-red-500";default:return"bg-gray-400"}}function U(){var a;r.value.quantity<(((a=d.value)==null?void 0:a.quantity)||1)&&r.value.quantity++}function $(){r.value.quantity>1&&r.value.quantity--}function H(){_.value.length>0&&(u.value=_.value[0].id),r.value.quantity=1,r.value.reason="",x.value=!0}async function Q(){if(!u.value){alert("请选择要出库的物品");return}if(!r.value.reason){alert("请选择出库原因");return}b.value=!0;try{await y.outboundMaterial(u.value,N.userName,r.value.quantity,r.value.reason),alert("出库成功！"),x.value=!1,await y.fetchMaterials()}catch(a){alert("出库失败: "+a.message)}finally{b.value=!1}}function R(a){k.push(`/material/${a}`)}function E(a){u.value=a.id,r.value.quantity=1,r.value.reason="",x.value=!0}function L(){k.back()}return J(async()=>{m.value=!0;try{await y.fetchMaterials()}finally{m.value=!1}}),(a,e)=>{var C;return o(),l("div",X,[t("div",Y,[t("div",Z,[t("button",{onClick:L,class:"flex items-center text-gray-500 mb-2"},[...e[3]||(e[3]=[t("svg",{class:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),S(" 返回 ",-1)])]),t("h2",tt,n(w.value),1),t("p",et,"共 "+n(c.value.length)+" 瓶，总数量 "+n(z.value),1)]),t("div",st,[p.value.normal>0?(o(),l("span",at," 正常 "+n(p.value.normal),1)):i("",!0),p.value.warning>0?(o(),l("span",nt," 预警 "+n(p.value.warning),1)):i("",!0),p.value.expired>0?(o(),l("span",ot," 过期 "+n(p.value.expired),1)):i("",!0)]),c.value.length>0?(o(),l("div",lt,[t("button",{onClick:H,class:"btn btn-success w-full py-3 flex items-center justify-center"},[...e[4]||(e[4]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 13l-5 5m0 0l-5-5m5 5V6"})],-1),S(" 出库 ",-1)])])])):i("",!0),m.value?(o(),l("div",rt,[...e[5]||(e[5]=[t("svg",{class:"animate-spin h-8 w-8 text-primary-600",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):q.value.length===0?(o(),l("div",it,[...e[6]||(e[6]=[t("p",{class:"text-gray-500"},"暂无数据",-1)])])):(o(),l("div",ut,[(o(!0),l(j,null,M(q.value,s=>(o(),l("div",{key:s.id,class:f(["card border-l-4",{"border-green-500":s.calculatedStatus==="normal","border-yellow-500":s.calculatedStatus==="warning","border-red-500":s.calculatedStatus==="expired"||s.calculatedStatus==="out_of_stock"}])},[t("div",dt,[t("div",{class:f(["w-3 h-3 rounded-full mr-3 mt-1.5 flex-shrink-0",O(s.calculatedStatus)])},null,2),t("div",ct,[t("div",vt,[t("p",pt,n(s.unique_code),1),t("span",{class:f(["badge ml-2 text-xs",I(s.calculatedStatus)])},n(F(s.calculatedStatus)),3)]),t("div",yt,[s.batch?(o(),l("div",xt,"批号: "+n(s.batch),1)):i("",!0),s.specification?(o(),l("div",gt,"规格: "+n(s.specification),1)):i("",!0),t("div",null,"数量: "+n(s.quantity)+" "+n(s.unit||"瓶"),1),s.standard_number?(o(),l("div",bt,"标准编号: "+n(s.standard_number),1)):i("",!0),s.manufacturer?(o(),l("div",ft,"厂家: "+n(s.manufacturer),1)):i("",!0),s.concentration?(o(),l("div",mt,"浓度: "+n(parseFloat(s.concentration).toFixed(6)),1)):i("",!0)]),s.expiry_date?(o(),l("div",{key:0,class:f(["mt-1 text-xs",s.calculatedStatus==="expired"?"text-red-600":"text-gray-500"])}," 有效期至: "+n(h(s.expiry_date)),3)):i("",!0)]),t("div",_t,[t("button",{onClick:T=>R(s.id),class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200 transition-colors"}," 查看 ",8,ht),s.quantity>0?(o(),l("button",{key:0,onClick:T=>E(s),class:"px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200 transition-colors"}," 出库 ",8,kt)):(o(),l("span",wt,"已出完"))])])],2))),128))])),x.value?(o(),l("div",qt,[t("div",Ct,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"选择出库物品",-1)),t("div",St,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"选择要出库的物品",-1)),B(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),class:"input"},[e[7]||(e[7]=t("option",{value:""},"请选择",-1)),(o(!0),l(j,null,M(_.value,s=>(o(),l("option",{key:s.id,value:s.id,disabled:s.quantity<=0},n(s.unique_code)+" - 数量: "+n(s.quantity)+" - 有效期: "+n(h(s.expiry_date))+" "+n(s.calculatedStatus==="expired"?"(已过期)":"")+" "+n(s.calculatedStatus==="warning"?"(预警)":""),9,jt))),128))],512),[[D,u.value]])]),d.value?(o(),l("div",Mt,[t("div",Bt,[t("div",Dt,[e[9]||(e[9]=t("span",{class:"text-gray-500"},"物品名称",-1)),t("span",Vt,n(d.value.name),1)]),t("div",Nt,[e[10]||(e[10]=t("span",{class:"text-gray-500"},"唯一编码",-1)),t("span",zt,n(d.value.unique_code),1)]),t("div",Ft,[e[11]||(e[11]=t("span",{class:"text-gray-500"},"当前库存",-1)),t("span",It,n(d.value.quantity)+" "+n(d.value.unit),1)]),t("div",Ot,[e[12]||(e[12]=t("span",{class:"text-gray-500"},"有效期至",-1)),t("span",Ut,n(h(d.value.expiry_date)),1)])])])):i("",!0),t("div",$t,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"出库数量",-1)),t("div",Ht,[t("button",{onClick:$,class:"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100",disabled:r.value.quantity<=1},[...e[13]||(e[13]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])],8,Qt),t("span",Rt,n(r.value.quantity),1),t("button",{onClick:U,class:"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100",disabled:r.value.quantity>=((C=d.value)==null?void 0:C.quantity)},[...e[14]||(e[14]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,Et)])]),t("div",Lt,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"出库原因",-1)),B(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>r.value.reason=s),class:"input"},[...e[16]||(e[16]=[K('<option value="">请选择原因</option><option value="使用">实验使用</option><option value="检测消耗">检测消耗</option><option value="校准使用">校准使用</option><option value="质量检验">质量检验</option><option value="销毁">销毁</option><option value="调拨">调拨</option><option value="其他">其他</option>',8)])],512),[[D,r.value.reason]])]),t("div",Tt,[t("button",{onClick:e[2]||(e[2]=s=>x.value=!1),class:"btn btn-secondary flex-1 py-3"}," 取消 "),t("button",{onClick:Q,disabled:!u.value||!r.value.reason||b.value,class:"btn btn-success flex-1 py-3 disabled:opacity-50 disabled:cursor-not-allowed"},n(b.value?"处理中...":"确认出库"),9,At)])])])):i("",!0)])])}}};export{Kt as default};
