import{a as B,u as P,l as S,o as U,c as V,b as t,t as a,O as x,w as L,h as c,v as u,g,A as D,e as O,k as N,j as m,m as A,f as E}from"./index-R9P4HaMK.js";const R={class:"page-container"},z={class:"page-content"},F={class:"card mb-4"},H={class:"flex items-center"},T={class:"text-lg font-semibold text-gray-800"},$={class:"text-sm text-gray-500"},I={class:"badge badge-info mt-1"},q={class:"card mb-4"},G={class:"mb-4"},J={class:"mb-4"},K={class:"mb-4"},Q=["disabled"],W={class:"card mb-4"},X={class:"grid grid-cols-2 gap-4"},Y={class:"text-center p-3 bg-gray-50 rounded-xl"},Z={class:"text-2xl font-bold text-primary-600"},tt={class:"text-center p-3 bg-gray-50 rounded-xl"},et={class:"text-2xl font-bold text-green-600"},nt={__name:"ProfileView",setup(st){const b=E(),n=B();P();const r=m(!1),p=m(0),f=m(0),s=N({name:"",phone:"",department:""}),v=O(()=>n.userName);async function y(){r.value=!0;try{await n.updateUserProfile({name:s.name,phone:s.phone,department:s.department}),alert("保存成功！")}catch(o){alert("保存失败: "+o.message)}finally{r.value=!1}}async function h(){confirm("确定要退出登录吗？")&&(await n.signOut(),b.push("/login"))}async function w(){try{const o=await A(),e=Object.keys(o[0]),i=[e.join(","),...o.map(C=>e.map(M=>`"${C[M]||""}"`).join(","))].join(`
`),d=new Blob([i],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(d),l.download=`标准物质清单_${new Date().toLocaleDateString()}.csv`,l.click(),alert("导出成功！")}catch(o){alert("导出失败: "+o.message)}}function k(){confirm("确定要清除本地缓存吗？这不会删除云端数据。")&&(localStorage.clear(),alert("缓存已清除，请刷新页面。"))}async function j(){try{const o=await D(null,1e3);p.value=o.filter(e=>e.operation==="inbound").length,f.value=o.filter(e=>e.operation==="outbound").length}catch(o){console.error("获取统计数据失败:",o)}}function _(){n.userProfile&&(s.name=n.userProfile.name||"",s.phone=n.userProfile.phone||"",s.department=n.userProfile.department||"")}return S(()=>{_(),j()}),(o,e)=>{var i,d;return U(),V("div",R,[t("div",z,[t("div",F,[t("div",H,[e[3]||(e[3]=t("div",{class:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mr-4"},[t("svg",{class:"w-8 h-8 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),t("div",null,[t("h2",T,a(v.value),1),t("p",$,a((i=x(n).user)==null?void 0:i.email),1),t("span",I,a(((d=x(n).userProfile)==null?void 0:d.role)||"用户"),1)])])]),t("div",q,[e[7]||(e[7]=t("h3",{class:"text-base font-semibold text-gray-800 mb-4"},"个人信息",-1)),t("form",{onSubmit:L(y,["prevent"])},[t("div",G,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"用户名",-1)),c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.name=l),type:"text",class:"input",placeholder:"请输入用户名"},null,512),[[u,s.name]])]),t("div",J,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"电话",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.phone=l),type:"tel",class:"input",placeholder:"请输入电话号码"},null,512),[[u,s.phone]])]),t("div",K,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"部门",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.department=l),type:"text",class:"input",placeholder:"请输入所在部门"},null,512),[[u,s.department]])]),t("button",{type:"submit",class:"btn btn-primary w-full",disabled:r.value},a(r.value?"保存中...":"保存修改"),9,Q)],32)]),t("div",W,[e[10]||(e[10]=t("h3",{class:"text-base font-semibold text-gray-800 mb-4"},"我的数据",-1)),t("div",X,[t("div",Y,[t("p",Z,a(p.value),1),e[8]||(e[8]=t("p",{class:"text-xs text-gray-500"},"入库次数",-1))]),t("div",tt,[t("p",et,a(f.value),1),e[9]||(e[9]=t("p",{class:"text-xs text-gray-500"},"出库次数",-1))])])]),t("div",{class:"card mb-4"},[e[13]||(e[13]=t("h3",{class:"text-base font-semibold text-gray-800 mb-4"},"快速操作",-1)),t("div",{class:"space-y-3"},[t("button",{onClick:w,class:"w-full flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors"},[...e[11]||(e[11]=[g('<div class="flex items-center"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3"><svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></div><span class="text-sm font-medium text-gray-800">导出全部数据</span></div><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>',2)])]),t("button",{onClick:k,class:"w-full flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors"},[...e[12]||(e[12]=[g('<div class="flex items-center"><div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-3"><svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></div><span class="text-sm font-medium text-gray-800">清除本地缓存</span></div><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>',2)])])])]),t("button",{onClick:h,class:"btn btn-danger w-full py-3"}," 退出登录 "),e[14]||(e[14]=t("p",{class:"text-center text-xs text-gray-400 mt-6"}," 标准物质管理系统 v1.0.0 ",-1))])])}}};export{nt as default};
