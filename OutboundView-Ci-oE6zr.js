import{u as z,a as I,p as N,l as U,o as i,c as u,b as t,h as _,v as F,F as k,r as h,t as l,d as m,q as w,g as H,j as c,e as C,f as E}from"./index-R9P4HaMK.js";const A={class:"page-container"},G={class:"page-content"},R={class:"mb-4"},T={class:"relative"},$={key:0,class:"flex justify-center py-12"},J={key:1,class:"text-center py-12"},K={key:2,class:"space-y-3"},P={class:"flex items-center justify-between"},W={class:"flex-1"},X={class:"text-base font-semibold text-gray-800"},Y={class:"flex items-center space-x-2 mt-1"},Z={key:0,class:"badge bg-green-100 text-green-700 text-xs"},tt={key:1,class:"badge bg-orange-100 text-orange-700 text-xs"},et={key:2,class:"badge bg-red-100 text-red-700 text-xs"},st={class:"flex items-center"},nt={class:"text-2xl font-bold text-gray-800 mr-3"},at=["onClick"],ot={key:0,class:"mt-3 pt-3 border-t border-gray-100"},lt=["value","disabled"],it={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ut={class:"bg-white rounded-2xl max-w-sm w-full p-6"},rt={class:"mb-4"},dt={class:"bg-gray-50 rounded-lg p-3"},ct={class:"flex justify-between text-sm mb-2"},vt={class:"font-medium"},mt={class:"flex justify-between text-sm mb-2"},yt={class:"font-medium"},pt={class:"flex justify-between text-sm"},ft={class:"font-medium"},xt={class:"mb-4"},bt={class:"flex items-center border border-gray-200 rounded-lg"},_t=["disabled"],gt={class:"w-16 text-center font-medium"},kt=["disabled"],ht={class:"mb-4"},wt={class:"flex space-x-3"},Ct=["disabled"],jt={__name:"OutboundView",setup(qt){const q=E(),v=z(),M=I(),y=c(""),j=C(()=>v.loading),p=c(!1),x=c(!1),f=c(null),d=c(""),a=c({materialId:"",name:"",unique_code:"",currentQuantity:0,quantity:1,reason:"",unit:""}),b=C(()=>{const o={};v.materials.filter(s=>s.quantity>0).map(s=>({...s,calculatedStatus:v.calculateStatus(s.expiry_date)})).forEach(s=>{const r=s.name;switch(o[r]||(o[r]={key:r,name:s.name,totalQuantity:0,normalCount:0,warningCount:0,expiredCount:0,items:[]}),o[r].totalQuantity+=s.quantity,o[r].items.push(s),s.calculatedStatus){case"normal":o[r].normalCount++;break;case"warning":o[r].warningCount++;break;case"expired":o[r].expiredCount++;break}});let n=Object.values(o);if(y.value){const s=y.value.toLowerCase();n=n.filter(r=>r.name.toLowerCase().includes(s)||r.items.some(O=>O.unique_code.toLowerCase().includes(s)))}return n});function S(o){return o?new Date(o).toLocaleDateString("zh-CN"):"-"}function Q(){}function B(o){f.value=o.key,d.value="";const e=o.items.find(n=>n.quantity>0);e&&(d.value=e.id),a.value={materialId:"",name:o.name,unique_code:"",currentQuantity:0,quantity:1,reason:"",unit:(e==null?void 0:e.unit)||"瓶"},x.value=!0}function g(){x.value=!1,f.value=null,d.value=""}function V(){a.value.quantity<a.value.currentQuantity&&a.value.quantity++}function D(){a.value.quantity>1&&a.value.quantity--}N(d,o=>{if(o){const e=b.value.find(s=>s.key===f.value),n=e==null?void 0:e.items.find(s=>s.id===o);n&&(a.value.materialId=n.id,a.value.unique_code=n.unique_code,a.value.currentQuantity=n.quantity,a.value.quantity=1,a.value.unit=n.unit)}});async function L(){if(!a.value.reason){alert("请选择出库原因");return}if(!a.value.materialId){alert("请选择要出库的物品");return}p.value=!0;try{await v.outboundMaterial(a.value.materialId,M.userName,a.value.quantity,a.value.reason),alert("出库成功！"),g(),q.push("/inventory")}catch(o){alert("出库失败: "+o.message)}finally{p.value=!1}}return U(async()=>{await v.fetchMaterials()}),(o,e)=>(i(),u("div",A,[t("div",G,[t("div",R,[t("div",T,[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),type:"text",class:"input pl-10",placeholder:"搜索要出库的标准物质...",onInput:Q},null,544),[[F,y.value]]),e[3]||(e[3]=t("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),j.value?(i(),u("div",$,[...e[4]||(e[4]=[t("svg",{class:"animate-spin h-8 w-8 text-primary-600",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):b.value.length===0?(i(),u("div",J,[...e[5]||(e[5]=[t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),t("p",{class:"mt-2 text-gray-500"},"暂无可出库的材料",-1)])])):(i(),u("div",K,[(i(!0),u(k,null,h(b.value,n=>(i(),u("div",{key:n.key,class:"card"},[t("div",P,[t("div",W,[t("h3",X,l(n.name),1),t("div",Y,[n.normalCount>0?(i(),u("span",Z," 正常"+l(n.normalCount),1)):m("",!0),n.warningCount>0?(i(),u("span",tt," 预警"+l(n.warningCount),1)):m("",!0),n.expiredCount>0?(i(),u("span",et," 过期"+l(n.expiredCount),1)):m("",!0)])]),t("div",st,[t("span",nt,l(n.totalQuantity),1),t("button",{onClick:s=>B(n),class:"btn btn-success px-4 py-2"}," 出库 ",8,at)])]),f.value===n.key?(i(),u("div",ot,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"选择要出库的物品",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),class:"input"},[e[6]||(e[6]=t("option",{value:""},"请选择",-1)),(i(!0),u(k,null,h(n.items,s=>(i(),u("option",{key:s.id,value:s.id,disabled:s.quantity<=0},l(s.unique_code)+" - 数量: "+l(s.quantity)+" - "+l(S(s.expiry_date))+" "+l(s.calculatedStatus==="expired"?"(已过期)":"")+" "+l(s.calculatedStatus==="warning"?"(预警)":""),9,lt))),128))],512),[[w,d.value]])])):m("",!0)]))),128))])),x.value?(i(),u("div",it,[t("div",ut,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"确认出库",-1)),t("div",rt,[t("div",dt,[t("div",ct,[e[8]||(e[8]=t("span",{class:"text-gray-500"},"物品名称",-1)),t("span",vt,l(a.value.name),1)]),t("div",mt,[e[9]||(e[9]=t("span",{class:"text-gray-500"},"唯一编码",-1)),t("span",yt,l(a.value.unique_code),1)]),t("div",pt,[e[10]||(e[10]=t("span",{class:"text-gray-500"},"当前库存",-1)),t("span",ft,l(a.value.currentQuantity)+" "+l(a.value.unit),1)])])]),t("div",xt,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"出库数量",-1)),t("div",bt,[t("button",{onClick:D,class:"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100",disabled:a.value.quantity<=1},[...e[11]||(e[11]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])],8,_t),t("span",gt,l(a.value.quantity),1),t("button",{onClick:V,class:"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100",disabled:a.value.quantity>=a.value.currentQuantity},[...e[12]||(e[12]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,kt)])]),t("div",ht,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"出库原因",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.reason=n),class:"input"},[...e[14]||(e[14]=[H('<option value="">请选择原因</option><option value="使用">实验使用</option><option value="检测消耗">检测消耗</option><option value="校准使用">校准使用</option><option value="质量检验">质量检验</option><option value="销毁">销毁</option><option value="调拨">调拨</option><option value="其他">其他</option>',8)])],512),[[w,a.value.reason]])]),t("div",wt,[t("button",{onClick:g,class:"btn btn-secondary flex-1"}," 取消 "),t("button",{onClick:L,class:"btn btn-success flex-1",disabled:p.value||!a.value.reason},l(p.value?"处理中...":"确认出库"),9,Ct)])])])):m("",!0)])]))}};export{jt as default};
