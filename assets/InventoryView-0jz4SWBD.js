import{u as L,l as T,o as a,c as o,b as s,h as z,v as D,F as h,r as m,n as k,i as Q,t as i,d as c,j as w,e as C,m as E,f as I}from"./index-R9P4HaMK.js";const N={class:"page-container"},$={class:"page-content"},F={class:"mb-4"},G={class:"relative"},O={class:"flex space-x-4 mb-4 overflow-x-auto pb-2 border-b border-gray-100"},R=["onClick"],U={key:1,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary-600"},W={key:0,class:"flex justify-center py-12"},A={key:1,class:"text-center py-12"},H={key:2,class:"space-y-3"},J=["onClick"],K={class:"flex items-center"},P={class:"text-base font-semibold text-gray-800 flex-1"},X={class:"flex items-center space-x-2"},Y={key:0,class:"badge bg-green-100 text-green-700 text-xs"},Z={key:1,class:"badge bg-orange-100 text-orange-700 text-xs"},ee={key:2,class:"badge bg-red-100 text-red-700 text-xs"},te={class:"text-2xl font-bold text-gray-800 ml-3"},se={key:0,class:"mt-2 pl-7"},ne={class:"flex flex-wrap gap-1"},ae={key:0,class:"inline-block px-2 py-0.5 bg-gray-100 text-gray-500 text-xs rounded"},oe={key:3,class:"fixed bottom-20 right-4"},ie={__name:"InventoryView",setup(re){const _=I(),p=L(),v=w(""),d=w("all"),b=C(()=>p.loading),q=[{label:"全部",value:"all"},{label:"正常",value:"normal"},{label:"预警",value:"warning"},{label:"过期",value:"expired"}],x=C(()=>{const n={};p.materials.filter(t=>t.quantity>0).map(t=>({...t,calculatedStatus:p.calculateStatus(t.expiry_date)})).forEach(t=>{const l=t.name;switch(n[l]||(n[l]={key:l,name:t.name,batch:t.batch,specification:t.specification,totalQuantity:0,normalCount:0,warningCount:0,expiredCount:0,uniqueCodes:[],items:[]}),n[l].totalQuantity+=t.quantity,n[l].items.push(t),t.calculatedStatus){case"normal":n[l].normalCount++;break;case"warning":n[l].warningCount++;break;case"expired":n[l].expiredCount++;break}t.unique_code&&n[l].uniqueCodes.push(t.unique_code)});let e=Object.values(n);const u=t=>t.expiredCount>0?"expired":t.warningCount>0?"warning":"normal";if(d.value!=="all"&&(e=e.filter(t=>u(t)===d.value)),v.value){const t=v.value.toLowerCase();e=e.filter(l=>{var g;return l.name.toLowerCase().includes(t)||((g=l.batch)==null?void 0:g.toLowerCase().includes(t))||l.uniqueCodes.some(V=>V.toLowerCase().includes(t))})}const f={normal:0,warning:1,expired:2};return e.sort((t,l)=>f[u(t)]-f[u(l)]),e});function M(n){return n.expiredCount>0?"expired":n.warningCount>0?"warning":"normal"}function y(n){return n==="all"?x.value.length:x.value.filter(r=>M(r)===n).length}function S(){}function j(n){_.push(`/group/${encodeURIComponent(n)}`)}async function B(){try{await E()}catch(n){alert("导出失败: "+n.message)}}return T(async()=>{await p.fetchMaterials()}),(n,r)=>(a(),o("div",N,[s("div",$,[s("div",F,[s("div",G,[z(s("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>v.value=e),type:"text",class:"input pl-10",placeholder:"搜索标准物质...",onInput:S},null,544),[[D,v.value]]),r[1]||(r[1]=s("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),s("div",O,[(a(),o(h,null,m(q,e=>s("button",{key:e.value,onClick:u=>d.value=e.value,class:k(["text-sm font-medium whitespace-nowrap pb-2 px-1 transition-colors relative",d.value===e.value?"text-primary-600":"text-gray-500"])},[Q(i(e.label)+" ",1),y(e.value)>0?(a(),o("span",{key:0,class:k(["ml-1 text-xs",d.value===e.value?"text-primary-600":"text-gray-400"])},i(y(e.value)),3)):c("",!0),d.value===e.value?(a(),o("div",U)):c("",!0)],10,R)),64))]),b.value?(a(),o("div",W,[...r[2]||(r[2]=[s("svg",{class:"animate-spin h-8 w-8 text-primary-600",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):x.value.length===0?(a(),o("div",A,[...r[3]||(r[3]=[s("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),s("p",{class:"mt-2 text-gray-500"},"暂无数据",-1)])])):(a(),o("div",H,[(a(!0),o(h,null,m(x.value,e=>(a(),o("div",{key:e.key,onClick:u=>j(e.name),class:"card cursor-pointer hover:shadow-md transition-shadow"},[s("div",K,[r[4]||(r[4]=s("svg",{class:"w-5 h-5 text-gray-400 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)),s("h3",P,i(e.name),1),s("div",X,[e.normalCount>0?(a(),o("span",Y," 正常"+i(e.normalCount),1)):c("",!0),e.warningCount>0?(a(),o("span",Z," 预警"+i(e.warningCount),1)):c("",!0),e.expiredCount>0?(a(),o("span",ee," 过期"+i(e.expiredCount),1)):c("",!0)]),s("span",te,i(e.totalQuantity),1)]),e.uniqueCodes.length>0?(a(),o("div",se,[s("div",ne,[(a(!0),o(h,null,m(e.uniqueCodes.slice(0,6),u=>(a(),o("span",{key:u,class:"inline-block px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded"},i(u),1))),128)),e.uniqueCodes.length>6?(a(),o("span",ae," +"+i(e.uniqueCodes.length-6),1)):c("",!0)])])):c("",!0)],8,J))),128))])),x.value.length>0?(a(),o("div",oe,[s("button",{onClick:B,class:"w-14 h-14 bg-primary-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-primary-700 transition-colors"},[...r[5]||(r[5]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])])])):c("",!0)])]))}};export{ie as default};
